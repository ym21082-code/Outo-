javascript:(function(){let t=null,defMs=200,pts=[],idx=0,loopCount=0,maxLoops=0,retryCount=0,ui=null;if(document.getElementById("ac-ui"))return;createUI();function createUI(){ui=document.createElement("div");ui.id="ac-ui";ui.style.cssText="position:fixed;bottom:20px;right:20px;width:190px;background:rgba(30,30,30,0.95);color:white;border-radius:8px;padding:12px;font-family:sans-serif;z-index:2147483647;box-shadow:0 4px 15px rgba(0,0,0,0.8);font-size:13px;border:1px solid #444;";let btnStyle="padding:6px 10px;cursor:pointer;background:#ddd;color:#000;border:1px solid #999;border-radius:4px;font-weight:bold;font-size:12px;";ui.innerHTML=`<div style='display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;border-bottom:1px solid #555;padding-bottom:5px'><strong id='ac-status' style='color:#0ff'>â¸ åœæ­¢ä¸­</strong><span style='cursor:pointer;font-size:16px;color:#999' onclick='document.getElementById("ac-ui").remove();window.acEnd()'>âœ–</span></div><div style='display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px'><button id='ac-btn-run' style='${btnStyle}background:#afa;grid-column:1/3'>â–¶ å†ç”Ÿ</button><button id='ac-btn-save' style='${btnStyle}'>ğŸ’¾ ä¿å­˜</button><button id='ac-btn-load' style='${btnStyle}'>ğŸ“‚ èª­è¾¼</button><button id='ac-btn-undo' style='${btnStyle}'>â†© æˆ»ã‚‹</button><button id='ac-btn-clear' style='${btnStyle}background:#faa;color:#500'>ğŸ—‘ å…¨æ¶ˆ</button></div><div style='margin-top:8px;font-size:11px;color:#eee;text-align:center'>ã‚¯ãƒªãƒƒã‚¯:é…ç½® / Shift+ã‚¯ãƒªãƒƒã‚¯:å¾…æ©Ÿ</div>`;document.body.appendChild(ui);document.getElementById("ac-btn-run").onclick=toggleRun;document.getElementById("ac-btn-save").onclick=save;document.getElementById("ac-btn-load").onclick=load;document.getElementById("ac-btn-undo").onclick=undo;document.getElementById("ac-btn-clear").onclick=clearAll;window.acEnd=end;}function updateUI(msg,isRunning){let st=document.getElementById("ac-status");let btn=document.getElementById("ac-btn-run");if(st){st.innerText=msg;st.style.color=isRunning?"#f00":"#0ff";}if(btn){btn.innerText=isRunning?"â¸ åœæ­¢":"â–¶ å†ç”Ÿ";btn.style.background=isRunning?"#faa":"#afa";}}function end(){stop();clearAll();document.removeEventListener("keydown",k);document.removeEventListener("click",c,true);if(ui)ui.remove();}function stop(){clearTimeout(t);t=null;pts.forEach(p=>p.d.style.background="rgba(0,255,255,0.7)");updateUI("â¸ åœæ­¢ä¸­",false);}function run(){pts.forEach(p=>p.d.style.background="rgba(0,255,255,0.7)");if(pts.length===0)return;let p=pts[idx];let el=p.sel?document.querySelector(p.sel):p.t;if(!el||!document.body.contains(el)){if(retryCount++<20){updateUI("âš ï¸æ¤œç´¢ä¸­ "+retryCount,true);p.d.style.background="orange";t=setTimeout(run,500);return;}else{stop();alert("è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: Step "+(idx+1));return;}}retryCount=0;el.scrollIntoView({block:"center",behavior:"smooth"});if(p.val!==undefined){el.value=p.val;el.dispatchEvent(new Event('input',{bubbles:true}));}else{el.click();}p.d.style.background="rgba(255,0,0,0.9)";if(idx===pts.length-1){loopCount++;if(maxLoops>0&&loopCount>=maxLoops){stop();alert("å®Œäº†");return;}}updateUI("â–¶ "+(idx+1)+"/"+pts.length+(maxLoops>0?" ("+loopCount+")":""),true);idx=(idx+1)%pts.length;let wait=p.wait||defMs;t=setTimeout(run,wait);}function toggleRun(){if(t){stop();}else if(pts.length){let input=prompt("è¨­å®š: é–“éš”(ms),å›æ•°(0=ç„¡é™)","200,0");if(input){let s=input.split(",");defMs=parseInt(s[0])||200;maxLoops=parseInt(s[1])||0;loopCount=0;retryCount=0;run();}}else{alert("ãƒãƒ¼ã‚«ãƒ¼ã‚’é…ç½®ã—ã¦ãã ã•ã„");}}function clearAll(){pts.forEach(p=>p.d.remove());pts=[];idx=0;stop();}function undo(){if(pts.length>0){let last=pts.pop();last.d.remove();idx=0;stop();}}function save(){localStorage.setItem("ac_ui_v2",JSON.stringify(pts.map(p=>({x:p.x,y:p.y,wait:p.wait,val:p.val,sel:uniqueSel(p.t)}))));alert("ä¿å­˜ã—ã¾ã—ãŸ");}function uniqueSel(el){if(el.id)return"#"+el.id;let path=[],parent;while(parent=el.parentNode){path.unshift(`${el.tagName}:nth-child(${[].indexOf.call(parent.children,el)+1})`);el=parent;if(el.tagName==='HTML')break;}return path.join(" > ");}function load(){let d=localStorage.getItem("ac_ui_v2");if(!d)return alert("ãƒ‡ãƒ¼ã‚¿ãªã—");let arr=JSON.parse(d);stop();clearAll();arr.forEach(a=>{let el=a.sel?document.querySelector(a.sel):document.elementFromPoint(a.x,a.y);if(el)add(a.x,a.y,el,a.wait,a.val);});alert("èª­è¾¼å®Œäº†");}function k(e){if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA")return;let key=e.key.toLowerCase();if(key==="z")toggleRun();if(key==="escape")end();if(key==="backspace")undo();}function c(e){if(t||e.target.closest("#ac-ui"))return;e.preventDefault();e.stopImmediatePropagation();let wait=undefined,val=undefined;if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"){let v=prompt("å…¥åŠ›æ–‡å­—","");if(v!==null)val=v;}if(e.shiftKey){let w=prompt("å¾…æ©Ÿ(ms)","1000");if(w)wait=parseInt(w);}add(e.pageX,e.pageY,e.target,wait,val);}function add(x,y,target,wait,val){let d=document.createElement("div");d.innerHTML=(pts.length+1)+(wait?`<br><span style='font-size:10px'>${wait}ms</span>`:"")+(val?"<br>ğŸ“":"");d.style.cssText="position:absolute;top:"+(y-15)+"px;left:"+(x-15)+"px;width:30px;height:30px;background:rgba(0,255,255,0.7);color:black;font-size:14px;font-weight:bold;text-align:center;line-height:1;display:flex;flex-direction:column;justify-content:center;align-items:center;border:2px solid blue;border-radius:50%;z-index:2147483646;pointer-events:none;user-select:none;font-family:sans-serif;box-shadow:0 0 5px white;";document.body.appendChild(d);pts.push({t:target,d:d,x:x,y:y,wait:wait,val:val});}document.addEventListener("click",c,{capture:true});document.addEventListener("keydown",k);})();
